---
import { LOCALES, type Locale, loadT } from '../../i18n';
import NewHeader from '../../components/NewHeader.astro';

export async function getStaticPaths() {
  return (LOCALES as readonly string[]).map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Locale };
const t = await loadT(lang, ['home', 'header', 'contact']);

// Función para obtener la URL con el idioma cambiado
function getLangUrl(newLang: Locale): string {
  const currentPath = Astro.url.pathname;
  const pathWithoutLang = currentPath.replace(/^\/(es|en|ca)/, '');
  return `/${newLang}${pathWithoutLang || '/contact'}`;
}

const langLabels: Record<Locale, string> = {
  es: 'ESP',
  en: 'ENG',
  ca: 'CAT'
};
---

<!DOCTYPE html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/images/favicon.png" />
    <meta name="description" content="Contacta con New Village Studio en Barcelona. Estamos aquí para ayudarte." />
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap');
    </style>
    <title>NewVillage | Contact</title>
  </head>
  <body>
    <div class="page-wrapper">
      <!-- Header -->
      <NewHeader lang={lang} overlay={false} />

      <!-- Contact Section -->
      <main class="contact-section">
        <div class="container">
          <div class="contact-header">
            <h1 class="contact-title">{t('contactPage.title')}</h1>
            <p class="contact-subtitle">{t('contactPage.subtitle')}</p>
          </div>

          <div class="contact-grid">
            <!-- Contact Form -->
            <div class="contact-form-container">
              <form class="contact-form" action="https://formspree.io/f/mlgjlkpy" method="POST">
                <div class="form-group">
                  <input type="text" id="name" name="name" placeholder={t('contactPage.form.name')} required />
                </div>
                <div class="form-group">
                  <input type="email" id="email" name="email" placeholder={t('contactPage.form.email')} required />
                </div>
                <div class="form-group">
                  <textarea id="message" name="message" rows="5" placeholder={t('contactPage.form.message')} required></textarea>
                </div>
                <div class="form-group checkbox-group">
                  <input type="checkbox" id="privacy" name="privacy" required />
                  <label for="privacy">{t('contactPage.form.privacy')}</label>
                </div>
                <button type="submit" class="submit-btn">{t('contactPage.form.send')}</button>
              </form>

              <!-- Success Message -->
              <div id="success-message" class="success-message">
                <div class="success-content">
                  <h3 class="success-title">¡GRACIAS POR TU MENSAJE!</h3>
                  <p class="success-text">Te contactaremos pronto.</p>
                  <button class="success-close-btn">CERRAR</button>
                </div>
              </div>
            </div>

            <!-- Contact Info -->
            <div class="contact-info-container">
              <h2 class="info-title">{t('contactPage.info.title')}</h2>
              
              <div class="info-item">
                <div class="info-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                  </svg>
                </div>
                <a href={`mailto:${t('contactPage.info.email')}`} class="info-text">{t('contactPage.info.email')}</a>
              </div>
              
              <div class="info-item">
                <div class="info-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
                  </svg>
                </div>
                <a href="https://wa.me/34623054832" target="_blank" class="info-text">{t('contactPage.info.phone')}</a>
              </div>
              
              <div class="info-item">
                <div class="info-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                  </svg>
                </div>
                <span class="info-text">{t('contactPage.info.address')}</span>
              </div>

              <!-- Map Placeholder (Optional) -->
              <div class="map-placeholder">
                <iframe
                  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d23904.488509640316!2d2.177432215625!3d41.409542!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12a4a2b7c0b9b9b9%3A0x4c7b6b8b8b8b8b8b8b8b!2sc%2F%20Pamplona%2073%2C%20Barcelona!5e0!3m2!1ses!2ses!4v1709740000000!5m2!1ses!2ses"
                  width="100%"
                  height="300"
                  style="border:0;"
                  allowfullscreen=""
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade">
                </iframe>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer class="custom-footer">
        <div class="container" style="display: block;">
          <div class="footer-top">
            <div class="footer-left">
              <img src="/images/logofooter.svg" alt="NewVillage Logo" class="footer-logo-img" />
            </div>
            <div class="footer-right">
              <nav class="footer-links">
                <a href={`/${lang}/#faqs`} class="footer-link">{t('footerLinks.faqs')}</a>
                <span class="footer-separator">|</span>
                <a href={`/${lang}/contact`} class="footer-link active">{t('footerLinks.contact')}</a>
                <span class="footer-separator">|</span>
                <a href={`/${lang}/legal`} class="footer-link">{t('footerLinks.legal')}</a>
                <span class="footer-separator">|</span>
                <a href={`/${lang}/privacy`} class="footer-link">{t('footerLinks.privacy')}</a>
                <span class="footer-separator">|</span>
                <a href="https://www.instagram.com/newvillagestudio" target="_blank" rel="noopener noreferrer" class="footer-social-link">
                  <svg class="footer-social-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                  </svg>
                </a>
              </nav>
            </div>
          </div>
          
          <div class="footer-bottom">
            <div class="footer-text-absolute">
              <span class="footer-text-main">NEW VILLAGE STUDIO.</span>
              <span class="footer-text-sub">MOVE, MEET & CONNECT</span>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>

<script>
  // Form submission handler
  const contactForm = document.querySelector('.contact-form');
  const successMessage = document.getElementById('success-message');
  const successCloseBtn = document.querySelector('.success-close-btn');
  const submitBtn = document.querySelector('.submit-btn');

  if (contactForm) {
    contactForm.addEventListener('submit', function(e) {
      // Prevent default form submission to show loading state
      e.preventDefault();

      // Show loading state
      if (submitBtn) {
        submitBtn.textContent = 'ENVIANDO...';
        submitBtn.disabled = true;
      }

      // Create FormData from the form
      const formData = new FormData(contactForm);

      // Submit to Formspree
      fetch(contactForm.action, {
        method: 'POST',
        body: formData,
        headers: {
          'Accept': 'application/json'
        }
      })
      .then(response => {
        if (response.ok) {
          // Success - show message
          showSuccessMessage();
          contactForm.reset(); // Clear form
        } else {
          // Error - you could show an error message here
          console.error('Error submitting form');
          alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo.');
      })
      .finally(() => {
        // Reset button state
        if (submitBtn) {
          submitBtn.textContent = 'ENVIAR';
          submitBtn.disabled = false;
        }
      });
    });
  }

  function showSuccessMessage() {
    if (successMessage) {
      successMessage.style.display = 'flex';
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }
  }

  function hideSuccessMessage() {
    if (successMessage) {
      successMessage.style.display = 'none';
      document.body.style.overflow = ''; // Restore scrolling
    }
  }

  // Close success message
  if (successCloseBtn) {
    successCloseBtn.addEventListener('click', hideSuccessMessage);
  }

  // Close on click outside
  if (successMessage) {
    successMessage.addEventListener('click', (e) => {
      if (e.target === successMessage) {
        hideSuccessMessage();
      }
    });
  }

  // Close on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && successMessage && successMessage.style.display === 'flex') {
      hideSuccessMessage();
    }
  });
</script>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Oswald', sans-serif;
    background-color: #ffffff;
    color: #2c2c2c;
    overflow-x: hidden;
  }

  .container {
    max-width: 1240px;
    margin: 0 auto;
    padding: 0 2rem;
    position: relative;
    height: 100%;
    width: 100%;
  }

  .contact-section {
    padding: 4rem 0 8rem 0;
    min-height: 80vh;
  }

  .contact-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .contact-title {
    font-size: 60px;
    font-weight: 500;
    margin-bottom: 1rem;
    color: #2c2c2c;
    text-transform: uppercase;
  }

  .contact-subtitle {
    font-size: 24px;
    font-weight: 300;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .contact-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: start;
  }

  /* Form */
  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group label {
    font-size: 18px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .form-group input,
  .form-group textarea {
    padding: 1rem;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-family: 'Oswald', sans-serif; /* Usar la misma fuente */
    font-size: 16px;
    background: #f9f9f9;
    transition: border-color 0.3s ease;
  }

  .form-group input::placeholder,
  .form-group textarea::placeholder {
    color: #999;
    font-weight: 300;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    border-color: #ED6D64;
    outline: none;
  }

  .checkbox-group {
    flex-direction: row;
    align-items: center;
    gap: 0.5rem;
  }

  .checkbox-group input {
    width: auto;
    margin: 0;
  }

  .checkbox-group label {
    font-size: 14px;
    font-weight: 300;
    text-transform: none;
    letter-spacing: normal;
    cursor: pointer;
  }

  .submit-btn {
    background-color: #ED6D64;
    color: white;
    padding: 0.8rem 2.5rem;
    border: none;
    border-radius: 50px;
    font-family: 'Oswald', sans-serif;
    font-size: 18px;
    font-weight: 500;
    text-transform: uppercase;
    cursor: pointer;
    align-self: flex-start;
    transition: background-color 0.3s ease;
    letter-spacing: 0.05em;
  }

  .submit-btn:hover {
    background-color: #d15b52;
  }

  /* Info */
  .contact-info-container {
    background-color: #EEF5F8;
    padding: 3rem;
    border-radius: 10px;
  }

  .info-title {
    font-size: 32px;
    font-weight: 500;
    margin-bottom: 2rem;
    text-transform: uppercase;
    color: #2c2c2c;
  }

  .info-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .info-icon {
    width: 30px;
    height: 30px;
    color: #ED6D64;
    flex-shrink: 0;
  }

  .info-icon svg {
    width: 100%;
    height: 100%;
  }

  .info-text {
    font-size: 20px;
    font-weight: 300;
    color: #2c2c2c;
    text-decoration: none;
    letter-spacing: 0.05em;
  }

  .info-text:hover {
    color: #ED6D64;
  }

  .map-placeholder {
    margin-top: 2rem;
    border-radius: 5px;
    overflow: hidden;
  }

  /* Footer (Copied styles) */
  .custom-footer {
    background-color: #ffffff;
    padding: 50px 0 40px 0;
    margin-top: 0;
  }

  .footer-top {
    display: flex;
    justify-content: space-between;
    align-items: flex-end; /* Alineado abajo */
    margin-bottom: 100px;
  }

  .footer-logo-img {
    height: auto;
    width: 180px;
  }

  .footer-links {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .footer-link {
    font-family: 'Oswald', sans-serif;
    font-weight: 500;
    font-size: 28px;
    line-height: 35px;
    letter-spacing: 2px;
    color: #000000;
    text-decoration: none;
    text-transform: uppercase;
    transition: color 0.3s ease;
  }

  .footer-link:hover, .footer-link.active {
    color: #ED6D64;
  }

  .footer-separator {
    color: #ED6D64;
    font-size: 28px;
    font-weight: 500;
    margin: 0 4px;
  }

  .footer-social-icon {
    width: 35px;
    height: 35px;
    color: #000000;
    margin-left: 8px;
    transition: color 0.3s ease;
  }

  .footer-social-icon:hover {
    color: #ED6D64;
  }

  .footer-bottom {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 280px;
    width: 100%;
    margin-top: 60px;
    overflow: visible;
  }

  .footer-bottom::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    height: 100%;
    max-width: 1000px;
    background-color: #ED6D64;
    -webkit-mask-image: url('/images/logoicon.svg');
    mask-image: url('/images/logoicon.svg');
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
    -webkit-mask-size: contain;
    mask-size: contain;
    opacity: 0.4;
    z-index: 0;
    pointer-events: none;
  }

  .footer-text-absolute {
    position: relative;
    z-index: 10;
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: row; /* Todo en una línea */
    gap: 10px;
  }

  .footer-text-main {
    font-family: 'Oswald', sans-serif;
    font-weight: 500;
    font-size: 26px;
    line-height: 32px;
    letter-spacing: 2px;
    color: #000000;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .footer-text-sub {
    font-family: 'Oswald', sans-serif;
    font-weight: 300;
    font-size: 26px;
    line-height: 32px;
    letter-spacing: 2px;
    color: #000000;
    text-transform: uppercase;
    white-space: nowrap;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .contact-title { font-size: 48px; }
    
    .footer-top {
      margin-bottom: 80px;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }
    
    .footer-links {
      justify-content: center;
    }
    
    .footer-link, .footer-separator { font-size: 24px; line-height: 34px; }
    .footer-text-main, .footer-text-sub { font-size: 26px; line-height: 34px; }
    .footer-text-absolute { flex-direction: column; gap: 5px; }
    .footer-logo-img { width: 180px; }
  }

  @media (max-width: 768px) {
    .container { padding: 0 1.5rem; }
    
    .contact-grid {
      grid-template-columns: 1fr;
      gap: 3rem;
    }

    .contact-title {
      font-size: 36px;
    }

    .contact-subtitle {
      font-size: 18px;
    }

    /* Footer Mobile */
    .custom-footer {
      padding: 30px 0;
      margin-top: 0;
    }

    .footer-top {
      flex-direction: column;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
    }

    .footer-links {
      flex-direction: column;
      gap: 10px;
    }

    .footer-link {
      font-size: 24px;
      line-height: 30px;
    }

    .footer-separator {
      display: none;
    }

    .footer-social-icon {
      margin-left: 0;
      margin-top: 20px;
    }

    .footer-bottom {
      min-height: 200px;
      margin-top: 20px;
    }

    .footer-text-absolute {
      flex-direction: column;
      gap: 0;
    }

    .footer-text-main,
    .footer-text-sub {
      font-size: 24px;
      line-height: 32px;
      letter-spacing: 2px;
      white-space: normal;
    }
  }

  /* Success Message */
  .success-message {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
  }

  .success-content {
    background: white;
    padding: 3rem 2rem;
    border-radius: 10px;
    text-align: center;
    max-width: 400px;
    width: 90%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    animation: slideUp 0.3s ease;
  }

  .success-title {
    font-family: 'Oswald', sans-serif;
    font-weight: 600;
    font-size: 28px;
    color: #2c2c2c;
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .success-text {
    font-family: 'Oswald', sans-serif;
    font-weight: 300;
    font-size: 20px;
    color: #666;
    margin-bottom: 2rem;
    letter-spacing: 0.05em;
  }

  .success-close-btn {
    background: #ED6D64;
    color: white;
    border: none;
    padding: 0.6rem 1.8rem;
    border-radius: 50px;
    font-family: 'Oswald', sans-serif;
    font-weight: 500;
    font-size: 14px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background-color 0.3s ease;
    letter-spacing: 0.05em;
  }

  .success-close-btn:hover {
    background: #d15b52;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Success Message Mobile */
  @media (max-width: 768px) {
    .success-content {
      padding: 2rem 1.5rem;
    }

    .success-title {
      font-size: 24px;
    }

    .success-text {
      font-size: 18px;
    }

    .success-close-btn {
      padding: 0.6rem 1.5rem;
      font-size: 14px;
    }
  }
</style>
